<!--Section Content-->
<section class="container container-top">

  <div class="stories-mobile">
    <div class="stories-mobile-wrapper">
      <div class="stories-mobile-image-wrapper">
        <img class="stories-mobile-image" src="./assets/img/pretty.jpeg" />
      </div>
      <a href="#" class="stories-mobile-owner-name">virat</a>
    </div>
  </div>

  <div class="sidebar">
    <div class="sidebar-user">
      <%= link_to (instagram_profile_path) do %>
        <div class="sidebar-user-image-wrapper sidebar_profile">
          <% if current_user.avatar.attached? %>
            <%= image_tag url_for(current_user.avatar),class: "sidebar-image" %>
          <% else %>

            <svg viewBox="0 0 16 16" class= "sidebar-image" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"/>
              <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
              <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
            </svg>
          <% end %>
          
          <div class="sidebar-owner-wrapper">
            <span class="sidebar-owner-name">
              <%= current_user.username %>
            </span>
          </div>
        </div>
      <% end %>
    </div>
    
    <div class="suggested">
      <header class="suggested-header">
        <span class="suggested-header-title">Suggestions For You</span>
        <a class="suggested-header-link" href="#">See All</a>
      </header>
      <div class="suggested-wrapper">
        <div class="sidebar-image-wrapper">
          <img class="sidebar-image" src="./assets/img/pretty.jpeg" />
        </div>
        <div class="sidebar-owner-wrapper">
          <a href="#" class="sidebar-owner-name">sagar</a>
          <span class="sidebar-owner-other">Friend on Facebook</span>
        </div>
        <a href="#">Follow</a>
      </div>
    </div>
  </div>
  
  <div class="stories">
    <header class="stories-header">
      <span class="stories-header-title">Stories</span>
      <a class="stories-header-link" href="#">Watch All</a>
    </header>
    <div class="stories-wrapper">
      <div class="sidebar-image-wrapper">
        <img class="sidebar-image" src="./assets/img/pretty.jpeg" />
      </div>
      <div class="sidebar-owner-wrapper">
        <a href="#" class="sidebar-owner-name">sagar</a>
        <span class="sidebar-owner-other">3 HOURS AGO</span>
      </div>
    </div>
  </div>

  <section class="content-container">
    <!--CONTENTS-->
    <div class="posts">
      <!--CONTENT CARD-->
      <% @posts.each do |post| %>

        <%= render partial: "post",locals: {home_post: post} %>
      <% end %>
    </div>

    <!--SIDEBAR-->
    
    <%= render partial: "shared/post_modal" %>


    <script>
      $("body").on("click",".comment_submit", function(event){
        var home_comment_post_btn = $(event.target);
        var comment_form = $(home_comment_post_btn).parent(".home_comment");
        var section = $(comment_form).parents(".post-comments-wrapper");
        var append_comment = $(section).children(".post_two_comment")
        event.preventDefault();
       
        console.log(comment_form)
        $.ajax({
          url: "/comments",
          method: "POST",
          data: comment_form.serialize(),
          dataType: "json",
          success: function(comment_data){
            if(comment_data.success === true) {
              comment_text = "<div>"+ "<a href = '/users_profile/"+ comment_data.comment.user.id   +"'"+ "class = 'post-comment-author'"+ ">"+ comment_data.comment.user.username +"</a>" + " "+comment_data.comment.text + "</div>"
              $(append_comment).append(comment_text);
              $(comment_form).children(".add-comment").val("");

            }
          }
        })
      })




      current_page = <%= @page %>

      $(window).scroll(function(){
        if($(window).scrollTop() + $(window).height() >= $(document).height()) {
          current_page += 1;

          $.ajax({
            url: "/home?page=" + current_page,
            dataType: "JSON",
            success: function(post_data){
              if(post_data.success === true) {
                $(".posts").append(post_data.post);
              }
            }
          })
        }
      })
    </script>
  </section>

</section>



